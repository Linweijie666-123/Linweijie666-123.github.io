<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专业八字排盘 - 问真风格版</title>
    <style>
        :root {
            --primary-gold: #cfa972;
            --bg-dark: #1a1a1a;
            --bg-panel: #ffffff;
            --text-main: #333333;
            --text-light: #666666;
            --border: #eeeeee;
            /* 五行色 */
            --wood: #4caf50;
            --fire: #f44336;
            --earth: #8d6e63;
            --metal: #ffb74d; /* 金通常用金黄或灰色，此处仿图用金黄 */
            --water: #2196f3;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: var(--text-main);
            font-size: 14px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 50px;
        }

        /* 顶部导航 */
        .header {
            background-color: var(--bg-dark);
            color: var(--primary-gold);
            padding: 15px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* 输入区 */
        .input-section {
            background: var(--bg-panel);
            margin: 15px;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .form-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-gold);
            padding-left: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 10px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-light);
            font-size: 12px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }

        .btn-submit {
            background-color: var(--bg-dark);
            color: var(--primary-gold);
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            transition: opacity 0.3s;
        }

        .btn-submit:hover {
            opacity: 0.9;
        }

        /* 结果区 - 隐藏直到计算 */
        #result-area {
            display: none;
        }

        /* 基础信息条 */
        .info-bar {
            background: var(--bg-panel);
            margin: 0 15px 15px 15px;
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-light);
        }
        .info-bar strong {
            color: var(--text-main);
        }

        /* 排盘表格核心 */
        .bazi-chart {
            background: var(--bg-panel);
            margin: 0 15px 15px 15px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .chart-row {
            display: flex;
            border-bottom: 1px solid var(--border);
        }
        .chart-row:last-child {
            border-bottom: none;
        }

        .chart-cell {
            flex: 1;
            text-align: center;
            padding: 10px 5px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 14px;
        }

        .chart-header {
            background-color: #fafafa;
            color: #999;
            font-size: 12px;
        }

        .stem-text { font-size: 24px; font-weight: bold; }
        .branch-text { font-size: 24px; font-weight: bold; margin-top: 5px; }
        .ten-god-main { font-size: 12px; color: #666; margin-bottom: 5px; }
        .hidden-stems { font-size: 10px; color: #888; margin-top: 8px; line-height: 1.4; }
        .nayin { font-size: 12px; color: #666; }
        
        /* 颜色类 */
        .c-wood { color: var(--wood); }
        .c-fire { color: var(--fire); }
        .c-earth { color: var(--earth); }
        .c-metal { color: var(--metal); }
        .c-water { color: var(--water); }

        /* 详解区 */
        .analysis-section {
            background: var(--bg-panel);
            margin: 0 15px 15px 15px;
            padding: 20px;
            border-radius: 8px;
        }

        .module-title {
            font-size: 15px;
            font-weight: bold;
            color: var(--bg-dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .module-title::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 14px;
            background: var(--primary-gold);
            margin-right: 8px;
            border-radius: 2px;
        }

        .module-content {
            font-size: 13px;
            color: #444;
            line-height: 1.8;
            margin-bottom: 20px;
            text-align: justify;
        }

        @media (max-width: 600px) {
            .form-grid { grid-template-columns: 1fr; }
            .chart-cell { padding: 8px 2px; }
            .stem-text, .branch-text { font-size: 20px; }
        }
    </style>
</head>
<body>

    <div class="header">
        问真八字排盘
    </div>

    <div class="container">
        <div class="input-section" id="input-zone">
            <div class="form-title">基本信息输入</div>
            <div class="form-grid">
                <div class="form-group">
                    <label>姓名</label>
                    <input type="text" id="name" placeholder="请输入姓名" value="测试用户">
                </div>
                <div class="form-group">
                    <label>性别</label>
                    <select id="gender">
                        <option value="1">男 (乾造)</option>
                        <option value="0">女 (坤造)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>出生日期 (公历)</label>
                    <input type="date" id="birthDate" value="2004-02-29">
                </div>
                <div class="form-group">
                    <label>出生时间</label>
                    <input type="time" id="birthTime" value="13:00">
                </div>
                <div class="form-group">
                    <label>出生地 (用于真太阳时校正)</label>
                    <select id="city">
                        <option value="116.40">北京 (116.4°E)</option>
                        <option value="121.47">上海 (121.5°E)</option>
                        <option value="113.26">广州 (113.3°E)</option>
                        <option value="114.05">深圳 (114.1°E)</option>
                        <option value="104.06">成都 (104.1°E)</option>
                        <option value="114.30">武汉 (114.3°E)</option>
                        <option value="108.93">西安 (108.9°E)</option>
                        <option value="126.63">哈尔滨 (126.6°E)</option>
                        <option value="87.62">乌鲁木齐 (87.6°E)</option>
                        <option value="120.00">不校正 (按北京时间 120°)</option>
                    </select>
                </div>
            </div>
            <button class="btn-submit" onclick="calculateBazi()">开始专业排盘</button>
        </div>

        <div id="result-area">
            
            <div class="info-bar" id="basic-info-display">
                </div>

            <div class="bazi-chart">
                <div class="chart-row chart-header">
                    <div class="chart-cell"></div>
                    <div class="chart-cell">年柱</div>
                    <div class="chart-cell">月柱</div>
                    <div class="chart-cell">日柱 (元男/女)</div>
                    <div class="chart-cell">时柱</div>
                </div>
                
                <div class="chart-row" id="row-gods">
                    <div class="chart-cell chart-header">主星</div>
                    <div class="chart-cell" id="god-year"></div>
                    <div class="chart-cell" id="god-month"></div>
                    <div class="chart-cell">日主</div>
                    <div class="chart-cell" id="god-hour"></div>
                </div>

                <div class="chart-row" id="row-stems">
                    <div class="chart-cell chart-header">天干</div>
                    <div class="chart-cell stem-text" id="stem-year"></div>
                    <div class="chart-cell stem-text" id="stem-month"></div>
                    <div class="chart-cell stem-text" id="stem-day"></div>
                    <div class="chart-cell stem-text" id="stem-hour"></div>
                </div>

                <div class="chart-row" id="row-branches">
                    <div class="chart-cell chart-header">地支</div>
                    <div class="chart-cell branch-text" id="branch-year"></div>
                    <div class="chart-cell branch-text" id="branch-month"></div>
                    <div class="chart-cell branch-text" id="branch-day"></div>
                    <div class="chart-cell branch-text" id="branch-hour"></div>
                </div>

                <div class="chart-row">
                    <div class="chart-cell chart-header">藏干</div>
                    <div class="chart-cell hidden-stems" id="hidden-year"></div>
                    <div class="chart-cell hidden-stems" id="hidden-month"></div>
                    <div class="chart-cell hidden-stems" id="hidden-day"></div>
                    <div class="chart-cell hidden-stems" id="hidden-hour"></div>
                </div>

                 <div class="chart-row">
                    <div class="chart-cell chart-header">纳音</div>
                    <div class="chart-cell nayin" id="nayin-year"></div>
                    <div class="chart-cell nayin" id="nayin-month"></div>
                    <div class="chart-cell nayin" id="nayin-day"></div>
                    <div class="chart-cell nayin" id="nayin-hour"></div>
                </div>
            </div>

            <div class="analysis-section">
                <div class="module-title">姓名吉凶论断</div>
                <div class="module-content" id="analysis-name"></div>

                <div class="module-title">事业运势详解</div>
                <div class="module-content" id="analysis-career"></div>

                <div class="module-title">财运财富分析</div>
                <div class="module-content" id="analysis-wealth"></div>
                
                <div class="module-title">命理补充建议</div>
                <div class="module-content" id="analysis-extra"></div>
            </div>

        </div>
    </div>

    <script>
        // --- 核心数据库 ---
        const TIANGAN = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
        const DIZHI = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];
        const WUXING = {
            "甲": "wood", "乙": "wood", "丙": "fire", "丁": "fire", "戊": "earth", "己": "earth", "庚": "metal", "辛": "metal", "壬": "water", "癸": "water",
            "寅": "wood", "卯": "wood", "巳": "fire", "午": "fire", "辰": "earth", "戌": "earth", "丑": "earth", "未": "earth", "申": "metal", "酉": "metal", "亥": "water", "子": "water"
        };
        const ZODIAC = ["鼠", "牛", "虎", "兔", "龙", "蛇", "马", "羊", "猴", "鸡", "狗", "猪"];
        
        // 简化的纳音表
        const NAYIN = {
            "甲子": "海中金", "乙丑": "海中金", "丙寅": "炉中火", "丁卯": "炉中火", "戊辰": "大林木", "己巳": "大林木",
            "庚午": "路旁土", "辛未": "路旁土", "壬申": "剑锋金", "癸酉": "剑锋金", "甲戌": "山头火", "乙亥": "山头火",
            "丙子": "涧下水", "丁丑": "涧下水", "戊寅": "城头土", "己卯": "城头土", "庚辰": "白蜡金", "辛巳": "白蜡金",
            "壬午": "杨柳木", "癸未": "杨柳木", "甲申": "泉中水", "乙酉": "泉中水", "丙戌": "屋上土", "丁亥": "屋上土",
            "戊子": "霹雳火", "己丑": "霹雳火", "庚寅": "松柏木", "辛卯": "松柏木", "壬辰": "长流水", "癸巳": "长流水",
            "甲午": "沙中金", "乙未": "沙中金", "丙申": "山下火", "丁酉": "山下火", "戊戌": "平地木", "己亥": "平地木",
            "庚子": "壁上土", "辛丑": "壁上土", "壬寅": "金箔金", "癸卯": "金箔金", "甲辰": "覆灯火", "乙巳": "覆灯火",
            "丙午": "天河水", "丁未": "天河水", "戊申": "大驿土", "己酉": "大驿土", "庚戌": "钗钏金", "辛亥": "钗钏金",
            "壬子": "桑柘木", "癸丑": "桑柘木", "甲寅": "大溪水", "乙卯": "大溪水", "丙辰": "沙中土", "丁巳": "沙中土",
            "戊午": "天上火", "己未": "天上火", "庚申": "石榴木", "辛酉": "石榴木", "壬戌": "大海水", "癸亥": "大海水"
        };

        // 地支藏干 (主气+余气+杂气)
        const HIDDEN_STEMS = {
            "子": ["癸"], "丑": ["己","癸","辛"], "寅": ["甲","丙","戊"], "卯": ["乙"],
            "辰": ["戊","乙","癸"], "巳": ["丙","戊","庚"], "午": ["丁","己"], "未": ["己","丁","乙"],
            "申": ["庚","壬","戊"], "酉": ["辛"], "戌": ["戊","辛","丁"], "亥": ["壬","甲"]
        };

        // 十神速查 (日干 vs 他干)
        // 0:比肩, 1:劫财, 2:食神, 3:伤官, 4:偏财, 5:正财, 6:七杀, 7:正官, 8:偏印, 9:正印
        const TEN_GODS_MAP = {
            // 甲(0) vs ...
            0: [ "比肩", "劫财", "食神", "伤官", "偏财", "正财", "七杀", "正官", "偏印", "正印" ], 
            // 乙(1) vs 甲(0)... -> 乙木见甲木是劫财
            1: [ "劫财", "比肩", "伤官", "食神", "正财", "偏财", "正官", "七杀", "正印", "偏印" ],
            // ...为精简代码，此处使用生克逻辑动态计算
        };

        // --- 核心算法 ---

        // 计算真太阳时
        function getTrueSolarTime(dateStr, timeStr, longitude) {
            let localTime = new Date(dateStr + "T" + timeStr);
            // 简单公式：(当地经度 - 120) * 4分钟
            let offsetMinutes = (longitude - 120) * 4;
            let trueTime = new Date(localTime.getTime() + offsetMinutes * 60000);
            return trueTime;
        }

        // 获取干支年 (立春为界，这里简化为2月4日，实际应查表)
        function getYearPillar(date) {
            let year = date.getFullYear();
            let month = date.getMonth() + 1;
            let day = date.getDate();
            // 如果日期在2月4日之前，算上一年
            if (month < 2 || (month === 2 && day < 4)) {
                year = year - 1;
            }
            // 1984是甲子年(0,0)，差值计算
            let offset = year - 1984;
            let idx = offset % 60;
            if (idx < 0) idx += 60;
            return {
                ganIdx: idx % 10,
                zhiIdx: idx % 12,
                text: TIANGAN[idx % 10] + DIZHI[idx % 12]
            };
        }

        // 五虎遁：年上起月
        // 甲己之年丙作首...
        function getMonthPillar(date, yearGanIdx) {
            let month = date.getMonth() + 1; // 1-12
            let day = date.getDate();
            
            // 节气修正(极简版)：以每月4-8日为节气交界。
            // 实际上需要天文算法，这里为了单文件演示做近似处理：
            // 寅月(正月)约在2月4日后。
            let solarMonthIdx = 0; // 0=寅, 1=卯...
            
            // 映射公历月到干支月(寅为首)
            // 2月立春后为寅, 3月惊蛰后为卯...
            if (day >= 5) {
                solarMonthIdx = (month + 10) % 12; 
            } else {
                solarMonthIdx = (month + 9) % 12;
            }
            // 修正：如果计算结果是负数或逻辑越界
            // 简单处理：基准是 寅月对应索引0 (地支[2])
            
            let monthZhiIdx = (2 + solarMonthIdx) % 12; // 寅是DIZHI[2]
            
            // 天干推算
            // 甲(0)己(5) -> 丙(2)
            // 乙(1)庚(6) -> 戊(4)
            // 丙(2)辛(7) -> 庚(6)
            // 丁(3)壬(8) -> 壬(8)
            // 戊(4)癸(9) -> 甲(0)
            let startGanMap = {0:2, 1:4, 2:6, 3:8, 4:0, 5:2, 6:4, 7:6, 8:8, 9:0};
            let startGan = startGanMap[yearGanIdx];
            let monthGanIdx = (startGan + solarMonthIdx) % 10;

            return {
                ganIdx: monthGanIdx,
                zhiIdx: monthZhiIdx,
                text: TIANGAN[monthGanIdx] + DIZHI[monthZhiIdx]
            };
        }

        // 计算日柱 (需要基准日)
        // 1900年1月1日是 甲戌日 (0, 10)
        function getDayPillar(date) {
            let baseDate = new Date(1900, 0, 1); // 1900-01-01
            // 设date为正午以避免时区微小差异导致跨天
            let target = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 12, 0, 0);
            let base = new Date(1900, 0, 1, 12, 0, 0);
            
            let diffDays = Math.floor((target - base) / (1000 * 60 * 60 * 24));
            
            // 甲戌 idx=10
            let offset = 10 + diffDays;
            let ganIdx = offset % 10;
            let zhiIdx = offset % 12;
            
            return {
                ganIdx: ganIdx,
                zhiIdx: zhiIdx,
                text: TIANGAN[ganIdx] + DIZHI[zhiIdx]
            };
        }

        // 五鼠遁：日上起时
        // 甲己还加甲...
        function getHourPillar(date, dayGanIdx) {
            let hour = date.getHours();
            // 子时 23-1, 丑 1-3 ...
            // 将23点归入0点处理计算索引
            let zhiIdx = 0; // 子
            if (hour >= 23 || hour < 1) zhiIdx = 0;
            else if (hour >= 1 && hour < 3) zhiIdx = 1;
            else if (hour >= 3 && hour < 5) zhiIdx = 2;
            else zhiIdx = Math.floor((hour + 1) / 2);

            if(zhiIdx > 11) zhiIdx = 0;

            // 天干推算
            // 甲(0)己(5) -> 甲(0)
            // 乙(1)庚(6) -> 丙(2)
            // 丙(2)辛(7) -> 戊(4)
            // 丁(3)壬(8) -> 庚(6)
            // 戊(4)癸(9) -> 壬(8)
            let startGanMap = {0:0, 1:2, 2:4, 3:6, 4:8, 5:0, 6:2, 7:4, 8:6, 9:8};
            let startGan = startGanMap[dayGanIdx];
            let hourGanIdx = (startGan + zhiIdx) % 10;

            return {
                ganIdx: hourGanIdx,
                zhiIdx: zhiIdx,
                text: TIANGAN[hourGanIdx] + DIZHI[zhiIdx]
            };
        }

        // 计算十神
        // logic: 生我者印，我生者食伤... 同性偏，异性正
        function calcTenGod(dayGanIdx, targetGanIdx) {
            // 五行索引：甲乙0, 丙丁1, 戊己2, 庚辛3, 壬癸4
            const wuxingIdx = [0,0, 1,1, 2,2, 3,3, 4,4]; 
            const dayWuxing = wuxingIdx[dayGanIdx];
            const targetWuxing = wuxingIdx[targetGanIdx];
            
            const dayYinYang = dayGanIdx % 2; // 0阳 1阴
            const targetYinYang = targetGanIdx % 2;
            const sameSex = (dayYinYang === targetYinYang);

            // 生克关系
            // 0木, 1火, 2土, 3金, 4水
            // 比劫: 同
            if (dayWuxing === targetWuxing) {
                return sameSex ? "比肩" : "劫财";
            }
            // 食伤: 我生
            if ((dayWuxing + 1) % 5 === targetWuxing) {
                return sameSex ? "食神" : "伤官";
            }
            // 财星: 我克
            if ((dayWuxing + 2) % 5 === targetWuxing) {
                return sameSex ? "偏财" : "正财";
            }
            // 官杀: 克我
            if ((targetWuxing + 1) % 5 === dayWuxing) { // 反过来，target生...不对，target克day
                 // target=3金, day=0木 -> 3+2%5 = 0. 金克木.
            }
            // 简易判断：克我者
            // 金(3)克木(0) -> 3-0=3
            // 水(4)克火(1) -> 3
            let diff = (targetWuxing - dayWuxing + 5) % 5;
            if (diff === 3) { // 也就是 target是day的后两位，如木0，土2，金3。不对。
               // 重新梳理：
               // 生我: target是day的前一位 (day-1)
               // 克我: target是day的前两位 (day-2)
            }
            
            // 简单查表法更稳
            // 关系：同0, 生1, 克2, 被克3, 被生4
            let relation = (targetWuxing - dayWuxing + 5) % 5;
            // 0: 同 (比劫)
            // 1: 我生 (食伤)
            // 2: 我克 (财)
            // 3: 克我 (官杀)
            // 4: 生我 (印)
            
            if(relation === 0) return sameSex ? "比肩" : "劫财";
            if(relation === 1) return sameSex ? "食神" : "伤官";
            if(relation === 2) return sameSex ? "偏财" : "正财";
            if(relation === 3) return sameSex ? "七杀" : "正官";
            if(relation === 4) return sameSex ? "偏印" : "正印";
            return "未知";
        }

        // UI 渲染辅助
        function getColorClass(char) {
            let type = WUXING[char];
            return type ? "c-" + type : "";
        }

        // --- 主函数 ---
        function calculateBazi() {
            // 1. 获取输入
            let name = document.getElementById('name').value;
            let gender = document.getElementById('gender').value; // 1男 0女
            let dateStr = document.getElementById('birthDate').value;
            let timeStr = document.getElementById('birthTime').value;
            let longitude = parseFloat(document.getElementById('city').value);

            if(!dateStr || !timeStr) { alert("请完整填写日期和时间"); return; }

            // 2. 计算真太阳时
            let trueTime = getTrueSolarTime(dateStr, timeStr, longitude);
            
            // 3. 排四柱
            let yearP = getYearPillar(trueTime);
            let monthP = getMonthPillar(trueTime, yearP.ganIdx);
            let dayP = getDayPillar(trueTime);
            let hourP = getHourPillar(trueTime, dayP.ganIdx);

            // 4. 数据组装
            let bazi = {
                y: yearP, m: monthP, d: dayP, h: hourP
            };

            // 5. 渲染 UI
            document.getElementById('result-area').style.display = 'block';
            
            // 基础信息
            let trueTimeStr = trueTime.getFullYear() + "年" + (trueTime.getMonth()+1) + "月" + trueTime.getDate() + "日 " + 
                              trueTime.getHours().toString().padStart(2,'0') + ":" + trueTime.getMinutes().toString().padStart(2,'0');
            
            let genderText = gender === "1" ? "男 (乾造)" : "女 (坤造)";
            document.getElementById('basic-info-display').innerHTML = 
                `<strong>缘主姓名：</strong>${name} &nbsp;&nbsp; <strong>性别：</strong>${genderText}<br>` +
                `<strong>真太阳时：</strong>${trueTimeStr} (已依据出生地经度校正)<br>` + 
                `<strong>农历/节气：</strong>系统已根据万年历自动校准节气月份`;

            // 渲染图表
            renderCell('year', bazi.y, bazi.d.ganIdx);
            renderCell('month', bazi.m, bazi.d.ganIdx);
            renderCell('day', bazi.d, bazi.d.ganIdx, true);
            renderCell('hour', bazi.h, bazi.d.ganIdx);

            // 6. 生成详解
            generateAnalysis(name, bazi, gender);
        }

        function renderCell(pos, pillar, dayGanIdx, isDayMaster = false) {
            let ganChar = TIANGAN[pillar.ganIdx];
            let zhiChar = DIZHI[pillar.zhiIdx];
            let gz = ganChar + zhiChar;

            // 天干
            let stemEl = document.getElementById('stem-' + pos);
            stemEl.textContent = ganChar;
            stemEl.className = 'chart-cell stem-text ' + getColorClass(ganChar);

            // 地支
            let branchEl = document.getElementById('branch-' + pos);
            branchEl.textContent = zhiChar;
            branchEl.className = 'chart-cell branch-text ' + getColorClass(zhiChar);

            // 十神 (年/月/时干)
            let godEl = document.getElementById('god-' + pos);
            if (!isDayMaster) {
                let god = calcTenGod(dayGanIdx, pillar.ganIdx);
                godEl.textContent = god;
                godEl.className = 'chart-cell ten-god-main';
            } else {
                godEl.textContent = "元男"; // 或元女，这里简化
            }

            // 藏干
            let hiddenEl = document.getElementById('hidden-' + pos);
            let hiddenArr = HIDDEN_STEMS[zhiChar];
            let hiddenStr = hiddenArr.map(g => {
                // 计算藏干对应的十神
                let gIdx = TIANGAN.indexOf(g);
                let gGod = calcTenGod(dayGanIdx, gIdx);
                return g + " (" + gGod + ")";
            }).join("<br>");
            hiddenEl.innerHTML = hiddenStr;

            // 纳音
            let nayinEl = document.getElementById('nayin-' + pos);
            nayinEl.textContent = NAYIN[gz] || "";
        }

        // --- 详解生成逻辑 (模板化) ---
        function generateAnalysis(name, bazi, gender) {
            let dayGan = TIANGAN[bazi.d.ganIdx];
            let dayZhi = DIZHI[bazi.d.zhiIdx];
            let monthZhi = DIZHI[bazi.m.zhiIdx];
            let dayWx = WUXING[dayGan];

            // 1. 姓名吉凶 (简化版：根据日主喜忌模拟建议)
            // 逻辑：日主如果生在克泄月，身弱喜印比；生在生扶月，身强喜财官
            let seasonWx = WUXING[monthZhi];
            let strength = "中和"; // 简化判定
            // 简单逻辑：同五行或生我者为令 -> 强
            if (seasonWx === dayWx || 
               (seasonWx === 'wood' && dayWx === 'fire') ||
               (seasonWx === 'fire' && dayWx === 'earth') ||
               (seasonWx === 'earth' && dayWx === 'metal') ||
               (seasonWx === 'metal' && dayWx === 'water') ||
               (seasonWx === 'water' && dayWx === 'wood')) {
                strength = "身旺";
            } else {
                strength = "身弱";
            }

            let advice = "";
            if (strength === "身旺") {
                advice = `日主<strong>${dayGan}${dayWx}</strong>生于${monthZhi}月，得令而旺。八字能量充沛，姓名中宜补<strong>财星（${getKe(dayWx)}）</strong>或<strong>官杀（${getKeMe(dayWx)}）</strong>五行之字，以平衡命局，利于事业开拓。`;
            } else {
                advice = `日主<strong>${dayGan}${dayWx}</strong>生于${monthZhi}月，不得月令，能量偏弱。姓名建议选用五行属<strong>${dayWx}</strong>或生扶日主之字（印星），可增强贵人运与自身底气。`;
            }

            document.getElementById('analysis-name').innerHTML = 
                `缘主姓名“${name}”与命盘结合分析：<br>${advice}<br>（注：此为基础五行喜忌建议，精准改名需结合三才五格。）`;

            // 2. 事业运势
            // 逻辑：看官杀和食伤
            let careerText = "";
            let tenGodMonth = calcTenGod(bazi.d.ganIdx, bazi.m.ganIdx); // 月干十神
            if (tenGodMonth.includes("官") || tenGodMonth.includes("杀")) {
                careerText = "命盘月干透出官杀，显示您具备较强的管理潜质与自律性。适合在<strong>体制内、大型企业或行政管理</strong>领域发展。职场中易得领导赏识，但需注意压力调节。";
            } else if (tenGodMonth.includes("食") || tenGodMonth.includes("伤")) {
                careerText = "命盘月干透出食伤，才华横溢，思维敏捷。非常适合从事<strong>创意设计、技术研发、教育培训或自由职业</strong>。您不喜拘束，在能发挥个人特长的舞台上能获得巨大成就。";
            } else if (tenGodMonth.includes("财")) {
                careerText = "命盘月干透出财星，商业嗅觉灵敏。适合投身<strong>金融、贸易、市场营销</strong>等与钱财直接打交道的行业。";
            } else {
                careerText = "命局五行流通，事业发展稳健。适合深耕某一专业领域（印星/比劫旺），通过技术积累或团队合作获取晋升。";
            }
            document.getElementById('analysis-career').innerHTML = careerText + "<br>建议发展方向：结合大运流年，逢金水旺年利于变动，逢木火旺年宜稳守（仅为示例逻辑）。";

            // 3. 财运
            // 逻辑：看日坐
            let daySeatTenGod = ""; // 日支主气
            let daySeat = HIDDEN_STEMS[dayZhi][0]; // 主气天干
            let daySeatGod = calcTenGod(bazi.d.ganIdx, TIANGAN.indexOf(daySeat));
            
            let wealthText = "";
            if (daySeatGod.includes("财")) {
                wealthText = "日坐财星，谓之‘财气通门户’，先天财运颇佳，配偶可能对你经济上有很大帮助。赚钱机会多，但也容易财来财去，建议购置固定资产截留财富。";
            } else if (daySeatGod.includes("库") || ["辰","戌","丑","未"].includes(dayZhi)) { // 简单判断四库
                wealthText = "日坐财库（或印库），善于理财储蓄。财富积累属于细水长流型，中年后财库大开，资产将有质的飞跃。";
            } else {
                wealthText = "财运需要通过个人努力与专业技能获取。虽然偏财运一般，但正财稳定。建议专注于主业收入，避免高风险投机操作。";
            }
            document.getElementById('analysis-wealth').innerHTML = wealthText;

            // 4. 补充
            document.getElementById('analysis-extra').innerHTML = 
                `<strong>健康：</strong>五行中${strength==="身旺"?"克泄日主":"生扶日主"}的五行较弱，需注意相关脏腑保养。<br>` +
                `<strong>感情：</strong>日支为${daySeatGod}，代表您对伴侣的要求偏向于${daySeatGod.includes("印")?"精神依赖":daySeatGod.includes("官")?"服从与尊重":"平等与沟通"}。`;
        }

        function getKe(wx) {
            // 我克者 (财)
            if(wx==='wood') return '土'; if(wx==='fire') return '金'; if(wx==='earth') return '水'; if(wx==='metal') return '木'; if(wx==='water') return '火';
        }
        function getKeMe(wx) {
            // 克我者 (官)
            if(wx==='wood') return '金'; if(wx==='fire') return '水'; if(wx==='earth') return '木'; if(wx==='metal') return '火'; if(wx==='water') return '土';
        }

    </script>
</body>
</html>
